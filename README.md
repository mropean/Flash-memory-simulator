# 요구분석 <Memory-simulator>

## 1. 플래시메모리 성질 이란?
플래시메모리(flash memory)는 전기적으로 데이터를 지우고 다시 기록할 수 있고 메모리 칩 안에 유지 시키는 데에 전력이 필요 없는 비휘발성 컴퓨터 기억 장치를 말한다. 플래시메모리는 읽기 속도가 빠르며 하드 디스크보다 충격에 강한 특징으로 인해 배터리로 동작하는 장치에서 저장 장치로 많이 사용된다. 플래시메모리는 블록을 지우기 전에 새로 쓸 수 없다. 즉, 덮어쓰기가 불가능하며 이미 데이터가 존재하는 블록에 새 데이터를 저장하려면 그 블록을 지운 다음에 써야 한다는 특징이 있다. 또 플래시메모리는 기록 횟수에 제한이 있다. 매체의 소재 자체의 한계로 인해 기록 가능 횟수에 한계가 있다. 이 횟수를 넘어가면 내용의 삭제 및 기록이 되지 않는다. 이 상태에 와도 읽기가 바로 안 되지는 않지만, 일반적으로 읽기와 쓰기 모두를 해야 하므로 더 이용이 어려워진다. 일반적인 이용 환경에서는 모든 데이터 영역에 균일하게 쓰기보다는 특정 데이터 영역을 더 많이 이용하는 경우가 많으므로 수명 연장을 위해 특정 셀만 재기록 되지 않도록 특수한 알고리즘을 적용해야 한다. 데이터가 있는 셀을 옮긴다든가 해서 특정 셀만 집중적으로 재기록 당하지 않고, 모든 셀이 평균적으로 비슷한 횟수로 재기록 되도록 컨트롤러를 제조해야 오래도록 쓸 수 있다. 이를 웨어레벨링이라 한다. 플래시메모리의 기본 단위는 어떻게 사용하는가에 따라 달라지는데, 읽기와 쓰기 단위는 섹터 단위이고 지우는 단위는 블록 단위이다. 보통 한 블록 안에 32개의 섹터가 존재하며 하나의 섹터 크기는 512바이트이다. 즉 1메가바이트 당 64개의 블록과 2048의 섹터가 존재하게 된다.

## 2. 과제의 설명
### 기본적으로
플래시메모리는 특수한 알고리즘을 만들어야 하지만 지금의 과제는 일반적인 메모리 시뮬레이터에서 덮어쓰기만 불가능하게 만든 프로그램이다. 보통 플래시메모리는 덮어쓰기 대신 프로그램이 사용자가 지정한 섹터가 아닌 다른 섹터에 저장하는 형식이다. 본 학생이 만든 프로그램에 관해 설명하자면 명령어를 입력받는 함수, 파일의 크기를 입력받아 생성하는 함수, 사용자로부터 입력받은 데이터를 파일에 입력하는 함수, 사용자로부터 입력받은 번호의 데이터를 화면에 출력하는 함수, 사용자로부터 입력받은 번호의 데이터들을 삭제하는 함수가 있다.

### 명령어를 입력받는 함수
처음에는 이전의 프로그램들처럼 번호를 입력해서 따로따로 입력하게 했지만, 다음 과제들을 생각하여 명령어를 입력받게 하여 다른 함수들에서 사용자가 입력하는 일이 없게 했다. 사용자가 입력한 문자열을 공백을 기준으로 토큰으로 나누어 어떤 함수를 불러올지 판단할 수 있게 했고 필요한 데이터들을 각 함수에 넘겨 줄 수 있게 했다. 

### 파일의 크기를 정하고 생성하는 함수
명령어를 입력받는 함수에서 받은 정수형 변수로 파일의 크기를 결정한다. 기본 생성 크기는 메가바이트 단위이며 1 메가바이트당 64개의 블록, 32개의 섹터, 한 섹터 당 512바이트를 표현하기 위해 입력한 크기로 첫 번째 반복이 이루어지고, 64개의 블록을 표현하기 위해 64회의 두 번째 반복이 이루어지며, 두 번째 반복 당 32개의 섹터를 표현하기 위해 32회의 세 번째 반복이 이루어진다. 세 번째 반복에서 512바이트를 표현하기 위해 510개의 공백이 반복을 사용하여 파일에 작성되고 마지막에 줄 넘김이 입력되어 총 512바이트의 섹터가 파일에 한 줄로 표현이 된다.

### 입력받은 데이터를 파일에 작성하는 함수
토큰으로 분리된 값 중에서 두 번째 값인 섹터 번호와 세 번째 값인 데이터가 함수로 넘어오면 함수가 실행된다. 우선 만들어진 파일을 열고 파일 포인터를 제일 첫 줄의 첫 번째로 이동시키고, 사용자가 입력한 섹터 번호에 512를 곱하여 파일 포인터를 사용자가 원하는 섹터의 줄로 이동시킨다. 이때 파일 포인터에서 한 칸 뒤 사이의 데이터를 읽어와 공백인지 아닌지를 판별하게 된다. 만약 읽어온 데이터가 처음 작성된 공백이 아니라면 데이터가 존재한다는 뜻이 되므로 덮어쓰기가 불가능하다는 메시지가 화면에 출력하게 되고 함수가 종료된다. 만약 읽어온 데이터가 공백이라면 다시 파일 포인터를 한 칸 앞으로 움직여 읽어온 자리에 있는 공백과 사용자가 입력한 데이터를 바꿔 생성된 파일의 크기를 변경시키지 않고 입력할 수 있게 한다.

### 입력받은 번호의 데이터를 화면에 출력하는 함수
토큰으로 분리된 값 중에서 두 번째 값인 섹터 번호가 넘어오고 함수가 실행된다. 위에 설명한 입력 함수와 마찬가지로 섹터 번호에 512를 곱하여 파일 포인터를 옮겨 사용자가 입력한 섹터의 번호로 이동하게 된다. 그 후 파일 포인터의 위치에서 한 칸 뒤 사이의 데이터를 읽어오게 된다. 읽어온 데이터가 공백이라면 화면에 입력된 데이터가 없다고 출력이 되고, 읽어온 데이터가 공백이 아니라면 정상적으로 파일에 작성되어있던 데이터가 화면에 출력되게 된다.

### 입력받은 번호의 데이터들을 지우는 함수
지우는 함수는 매우 특별하다. 플래시메모리의 특징에 따라 블록 단위로 지우게 되어있기 때문이다. 기존의 쓰기와 읽기는 섹터 단위로써 프로그램이 실행되었다면 지우기 함수는 블록 단위로 가지고 있는 섹터들의 데이터를 싹 날려버린다. 먼저 사용자가 입력한 값은 분명히 블록 번호이기 때문에 따로 계산을 해줘 파일에서 파일 포인터를 움직일 수 있다. 입력한 값에 32를 곱하면 블록의 첫 번째 섹터의 번호가 되고 섹터의 번호 + 31을 해주면 블록의 마지막 섹터의 번호가 나올 것이다. 즉, 위의 쓰기와 읽기 함수에서 입력한 섹터의 번호처럼 입력한 값에 32를 곱하고 그 값에 다시 512를 곱하여 파일에서 표현한 섹터의 줄 번호를 만드는 것이다. 앞에서 나온 값으로 파일 포인터를 움직이고 이 위치부터 32회의 첫 번째 반복을 실행하고 첫 번째 반복 당 510바이트의 공백문자와 줄 넘김이 입력되어 지우기 연산이 완료된다. 
